---
// Pas de fetch c√¥t√© serveur, tout se passe c√¥t√© client
---

<section class="recipes-list">
  <div class="rl-header">
    <div class="rl-title">
      <h2 class="rl-headline">
        Des recettes simples, sp√©cialement pour vous
      </h2>
    </div>
  </div>

  <p class="rl-empty" id="loading-message">Chargement des recettes...</p>
  <p class="rl-empty" id="error-message" style="display: none;"></p>
  
  <div class="rl-grid" role="list" id="recipes-grid" style="display: none;">
    <!-- Les recettes seront ins√©r√©es ici par JavaScript -->
  </div>
</section>

<script type="module">
  const API_URL = 'https://gourmet.cours.quimerch.com/recipes';
  
  async function loadRecipes() {
    const loadingEl = document.getElementById('loading-message');
    const errorEl = document.getElementById('error-message');
    const gridEl = document.getElementById('recipes-grid');
    
    try {
      const res = await fetch(`${API_URL}?limit=9`, {
        headers: { Accept: 'application/json' },
      });
      
      if (!res.ok) throw new Error('R√©ponse r√©seau non valide');
      
      const recipes = await res.json();
      
      if (loadingEl) loadingEl.style.display = 'none';
      
      if (recipes.length === 0) {
        if (errorEl) {
          errorEl.textContent = 'Aucune recette trouv√©e.';
          errorEl.style.display = 'block';
        }
        return;
      }
      
      if (gridEl) {
        gridEl.innerHTML = recipes.map(r => `
          <article class="card" role="listitem" data-id="${r.id}">
            <div class="card-media" aria-hidden="true">
              ${r.image_url 
                ? `<img src="${r.image_url}" alt="${r.name}" loading="lazy" decoding="async" />`
                : `<div class="fallback">Image manquante</div>`
              }
            </div>
            <div class="card-body">
              <div class="chip">${r.category || 'Autre'}</div>
              <h3 class="card-title">${r.name}</h3>
              <p class="card-desc">
                ${(r.description || '').slice(0, 140)}${r.description && r.description.length > 140 ? '‚Ä¶' : ''}
              </p>
              <div class="card-stats">
                <span>${r.servings || 0} pers</span>
                <span>‚Ä¢ ${r.cost || 0}‚Ç¨</span>
                <span>‚Ä¢ Pr√©pa ${r.prep_time || 0}m</span>
                <span>‚Ä¢ Cuisson ${r.cook_time || 0}m</span>
                <span>‚Ä¢ üî• ${r.calories || 0}</span>
              </div>
            </div>
          </article>
        `).join('');
        gridEl.style.display = 'grid';
      }
    } catch (err) {
      console.error(err);
      if (loadingEl) loadingEl.style.display = 'none';
      if (errorEl) {
        errorEl.textContent = 'Impossible de charger les recettes pour le moment.';
        errorEl.style.display = 'block';
      }
    }
  }
  
  // Charger les recettes au chargement de la page
  loadRecipes();
</script>

<style>
:root{
  --muted:#6b7280;
  --card-bg:#f7f7f7;
}

  .recipes-list{ padding:clamp(1.5rem, 3vw, 2.5rem); max-width:1200px; margin:0 auto; }
.rl-header{ display:flex; flex-wrap:wrap; gap:1rem; justify-content:center; align-items:center; margin-bottom:1.25rem; text-align:center; }
.rl-headline{ margin:0.35rem 0 0; font-size:clamp(1.9rem, 3vw, 2.6rem); color:#0f172a; line-height:1.15; font-weight:800; letter-spacing:-0.01em; }

  .rl-grid{ display:grid; gap:1rem; grid-template-columns:repeat(auto-fit, minmax(260px, 1fr)); }

  .card{
    display:flex;
    flex-direction:column;
    gap:0.65rem;
    border-radius:16px;
    overflow:hidden;
    background:var(--card-bg);
    color:#111827;
    box-shadow:
      0 14px 30px rgba(0,0,0,0.08),
      0 6px 12px rgba(0,0,0,0.06);
    min-height:100%;
  }
  .card-media{
    position:relative;
    width:100%;
    aspect-ratio:4/3;
    background:linear-gradient(135deg,#eceff4,#e5e7eb);
    overflow:hidden;
    display:block;
  }
  .card-media img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }
  .card-media .fallback{
    width:100%;
    height:100%;
    display:flex;
    align-items:center;
    justify-content:center;
    color:#6b7280;
    font-size:0.9rem;
    padding:0.5rem;
    text-align:center;
    background:linear-gradient(135deg, #e5e7eb, #f3f4f6);
  }

.card-body{ display:flex; flex-direction:column; gap:0.45rem; padding:0 1rem 1.1rem; }
.chip{ display:inline-flex; align-items:center; gap:0.35rem; padding:0.35rem 0.65rem; border-radius:999px; background:#fff3eb; color:#c2410c; font-size:0.8rem; border:1px solid rgba(249,115,22,0.2); width:max-content; }
.card-title{ margin:0; font-size:1.1rem; line-height:1.3; color:#0f172a; }
.card-desc{ margin:0; color:#374151; font-size:0.93rem; line-height:1.45; }
.card-stats{ display:flex; gap:0.45rem; flex-wrap:wrap; font-size:0.85rem; color:#6b7280; }

  .rl-empty{ margin:1rem 0; color:var(--muted); font-weight:600; }

  @media (max-width:768px){
    .card{ box-shadow:0 8px 25px rgba(15,23,42,0.16); }
  }
</style>
